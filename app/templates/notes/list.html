
{% extends "base.html" %}
{% block content %}

<div class="container rr-page">

 <div class="rr-header">
   <h1 class="rr-h1">Rassemblements à venir</h1>
   <a class="rr-add" href="{{ url_for('notes.create_note') }}">+ Ajouter un événement</a>
 </div>

 <div class="rr-layout">

   <!-- COLONNE GAUCHE -->
   <div class="rr-left">

     <!-- CATEGORIES -->
     <div class="rr-grid">

       <!-- Toutes -->
       <a class="rr-cat-link {% if not selected_cat %}is-active{% endif %}"
          href="{{ url_for('notes.list_notes') }}">
         <article class="rr-card category-default">
           <img class="rr-card-img"
                src="{{ url_for('static', filename='img/voiture.jpg') }}"
                alt="Toutes">
           <div class="rr-card-overlay"></div>
           <div class="rr-card-body">
             <div class="rr-badge">Toutes</div>
             <div class="rr-meta">Tous les évènements à venir</div>
           </div>
         </article>
       </a>

       <!-- Une carte par catégorie -->
       {% for cat in categories %}
         {% set img = image_map.get(cat, "voiture.jpg") %}
         <a class="rr-cat-link {% if selected_cat == cat %}is-active{% endif %}"
            href="{{ url_for('notes.list_notes', cat=cat) }}">
           <article class="rr-card category-{{ cat }}">
             <img class="rr-card-img"
                  src="{{ url_for('static', filename='img/' ~ img) }}"
                  alt="{{ cat }}">
             <div class="rr-card-overlay"></div>
             <div class="rr-card-body">
               <div class="rr-badge">{{ cat|capitalize }}</div>
               <div class="rr-meta">{{ counts.get(cat, 0) }} évènement(s) à venir</div>
             </div>
           </article>
         </a>
       {% endfor %}

     </div><!-- /rr-grid -->

     <!-- CARTES NOTES -->
     <div class="rr-notes">
       {% if filtered_notes and filtered_notes|length > 0 %}
         {% for note in filtered_notes %}
           {% set cat = (note.category or "voiture")|lower|trim %}
           <article class="rr-note-card">
             <img class="rr-note-img"
                  src="{{ url_for('static', filename='img/' ~ image_map.get(cat, 'voiture.jpg')) }}"
                  alt="{{ cat }}">
             <div class="rr-note-overlay"></div>

             <div class="rr-note-body">
               <div class="rr-note-badge">{{ cat|capitalize }}</div>

               <div class="rr-actions">
                 <a class="rr-btn rr-btn-edit"
                    href="{{ url_for('notes.edit_note', note_id=note.id) }}">Modifier</a>

                 <form class="rr-delete-form"
                       method="post"
                       action="{{ url_for('notes.delete_note', note_id=note.id) }}">
                   <button class="rr-btn rr-btn-del" type="submit">Supprimer</button>
                 </form>
               </div>
             </div>
           </article>
         {% endfor %}
       {% else %}
         <p class="rr-empty">Aucun évènement à venir{% if selected_cat %} pour cette catégorie{% endif %}.</p>
       {% endif %}
     </div><!-- /rr-notes -->

   </div><!-- /rr-left -->


   <!-- COLONNE DROITE -->
   <aside class="rr-right">
     {% if selected_cat %}
       <h2 class="rr-side-title">{{ selected_cat|capitalize }}</h2>
       <p class="rr-side-desc">
         {{ category_texts.get(selected_cat, "Tous les évènements à venir.") }}
       </p>

       <h3 class="rr-side-sub">Prochains évènements</h3>

       {% if events and events|length > 0 %}
         <div class="rr-events">
           {% for e in events %}
             <article class="rr-event">
               <div class="rr-event-row">
                 <div class="rr-event-title">{{ e.title }}</div>
                 <div class="rr-event-date">
                   {{ e.start_at.strftime("%d/%m/%Y") if e.start_at else "" }}
                 </div>
               </div>
             </article>
           {% endfor %}
         </div>
       {% else %}
         <p class="rr-empty">Aucun évènement à venir pour cette catégorie.</p>
       {% endif %}
     {% else %}
       <h2 class="rr-side-title">Choisis une catégorie</h2>
       <p class="rr-side-desc">Clique sur une photo à gauche pour afficher les évènements à venir.</p>
     {% endif %}
   </aside>

 </div><!-- /rr-layout -->

</div><!-- /container -->

{% endblock %}